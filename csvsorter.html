<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿«æ¨‚å·¥å…·äºº | CSV Column Sorter</title>
<link href="https://unpkg.com/tabulator-tables@5.5.2/dist/css/tabulator.min.css" rel="stylesheet">
<style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Hiragino Kaku Gothic ProN","Meiryo",system-ui,sans-serif;background:#fafafa;color:#333;min-height:100vh;display:flex;flex-direction:column}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;text-align:center;box-shadow:0 2px 10px rgba(102,126,234,0.3)}
    .header h1{color:#fff;font-size:1.8em;font-weight:600;letter-spacing:1px;margin-bottom:8px}
    .header p{color:rgba(255,255,255,0.9);font-size:14px}
    .main{max-width:1600px;margin:0 auto;padding:20px;flex:1;width:100%}
    .panels-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .panel{background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);overflow:hidden;display:flex;flex-direction:column}
    .panel-header{background:#2c3e50;color:#fff;padding:12px 15px;font-size:14px;font-weight:600}
    .panel-body{flex:1;padding:15px;display:flex;flex-direction:column;min-height:450px}
    .input-textarea{width:100%;flex:1;padding:12px;border:1px solid #e0e0e0;border-radius:6px;font-family:monospace;font-size:12px;background:#1e1e1e;color:#d4d4d4;min-height:350px;transition:0.3s;resize:none}
    .input-textarea.dragover{background:#2d2d2d;border:2px dashed #667eea}
    .btn{padding:8px 20px;border:none;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .2s}
    .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
    .btn-excel{background:linear-gradient(135deg,#1D7444 0%,#217346 100%);color:#fff}
    .btn-secondary{background:#fff;color:#666;border:1px solid #ddd}
    .btn-secondary:hover{background:#f5f5f5}
    .tool-options{background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08);padding:20px;margin-bottom:20px}
    .options-main{display:flex;flex-wrap:wrap;gap:20px;align-items:flex-end;margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid #eee}
    .advanced-panel{display:none;padding-top:10px}
    .advanced-panel.show{display:block}
    .option-group{border:1px solid #eee;border-radius:6px;padding:15px;background:#fafafa}
    .option-group h3{font-size:13px;font-weight:600;color:#555;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid #667eea}
    .form-group label{display:block;font-size:12px;color:#666;margin-bottom:6px;font-weight:500}
    .form-group input[type="text"], .form-group select{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:12px}
    .checkbox-group{display:flex;align-items:center;gap:8px;font-size:12px}
    .footer{background:#f1f1f1;text-align:center;padding:15px;color:#888;font-size:12px;border-top:1px solid #ddd}
    .hidden{display:none}
    #outputTable{height:400px}
    @media(max-width:1200px){.panels-container{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="header">
    <h1>å¿«æ¨‚å·¥å…·äºº | CSV Column Sorter</h1>
    <p>æ”¯æ´æ‹–æ›³èˆ‡æŒ‰éˆ•åŒ¯å…¥ã€è‡ªå‹•æ¸…ç†è¨»è§£ç©ºè¡Œã€Tabulator æ™ºæ…§æ’åºèˆ‡é›™è»Œ CSV/Excel åŒ¯å‡º</p>
</div>

<div class="main">
    <div class="panels-container">
        <div class="panel">
            <div class="panel-header">Input CSV (è²¼ä¸Šã€æ‹–æ›³æˆ–é»é¸åŒ¯å…¥)</div>
            <div class="panel-body">
                <textarea id="inputCSV" class="input-textarea" placeholder="å°‡ CSV æª”æ¡ˆæ‹–æ›³è‡³æ­¤ï¼Œæˆ–ç›´æ¥è²¼ä¸Šå…§å®¹..."></textarea>
                <div class="panel-buttons" style="margin-top:10px; display:flex; gap:10px; flex-wrap: wrap;">
                    <input type="file" id="fileInput" accept=".csv,.txt" hidden onchange="handleFileSelect(this)">
                    <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">ğŸ“ Import from file</button>
                    <button class="btn btn-secondary" onclick="clearInput()">âœ• Clear</button>
                    <button class="btn btn-secondary" onclick="copyInput()">ğŸ“‹ Copy Input</button>
                </div>
            </div>
        </div>
        <div class="panel">
            <div class="panel-header">Sorted & Filtered Result</div>
            <div class="panel-body">
                <div id="errorMessage" class="error-message hidden" style="color:#cb2431; background:#ffeef0; padding:10px; border-radius:6px; margin-bottom:10px; font-size:12px;"></div>
                <div id="outputTable"></div>
                <div class="panel-buttons" style="margin-top:10px; display:flex; gap:10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportCSV(false)">ğŸ’¾ Export CSV (Pure)</button>
                    <button class="btn btn-excel" onclick="exportCSV(true)">ğŸ“Š Export Excel (BOM)</button>
                    <button class="btn btn-secondary" onclick="copyOutput()">ğŸ“‹ Copy Result</button>
                </div>
            </div>
        </div>
    </div>

    <div class="tool-options">
        <div class="options-main">
            <div class="form-group" style="flex:1; min-width:200px;">
                <label>Delimiter</label>
                <select id="delimiter" onchange="updateTable()">
                    <option value="auto">Auto Detect</option>
                    <option value=",">, (Comma)</option>
                    <option value=";">; (Semicolon)</option>
                    <option value="\t">Tab</option>
                    <option value="|">| (Pipe)</option>
                </select>
            </div>
            <div class="checkbox-group" style="padding-bottom:10px">
                <input type="checkbox" id="hasHeaders" checked onchange="updateTable()">
                <label for="hasHeaders">First row is header</label>
            </div>
            <button class="btn btn-secondary" onclick="document.getElementById('advancedPanel').classList.toggle('show')">âš™ï¸ Advanced Settings</button>
        </div>

        <div id="advancedPanel" class="advanced-panel">
            <div class="options-grid">
                <div class="option-group">
                    <h3>Data Cleanup</h3>
                    <div class="form-group"><div class="checkbox-group"><input type="checkbox" id="deleteComments" checked onchange="updateTable()"><label for="deleteComments">Filter Comments</label></div></div>
                    <div class="form-group"><label>Comment symbol</label><input type="text" id="commentSymbol" value="#" maxlength="1" onchange="updateTable()"></div>
                    <div class="form-group"><div class="checkbox-group"><input type="checkbox" id="deleteEmptyLines" checked onchange="updateTable()"><label for="deleteEmptyLines">Delete Empty Lines</label></div></div>
                </div>
                <div class="option-group">
                    <h3>More Options</h3>
                    <div class="form-group"><label>Sort method</label><select id="sortMethod" onchange="updateTable()"><option value="alphabetical">Alphabetical</option><option value="numeric">Numeric</option></select></div>
                    <div class="form-group"><label>Sort order</label><select id="sortOrder" onchange="updateTable()"><option value="asc">Increasing</option><option value="desc">Decreasing</option></select></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    å¿«æ¨‚å·¥å…·äºº | CSV Column Sorter | v2.0 - 2026/01/15
</div>

<script src="https://unpkg.com/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
<script>
let table=null, headers=[];
const textarea = document.getElementById('inputCSV');

textarea.addEventListener('dragover', (e) => { e.preventDefault(); textarea.classList.add('dragover'); });
textarea.addEventListener('dragleave', () => { textarea.classList.remove('dragover'); });
textarea.addEventListener('drop', (e) => { e.preventDefault(); textarea.classList.remove('dragover'); processFile(e.dataTransfer.files[0]); });

function handleFileSelect(input) { processFile(input.files[0]); input.value = ''; }
function processFile(file) { if (file) { const reader = new FileReader(); reader.onload = (ev) => { textarea.value = ev.target.result; updateTable(); }; reader.readAsText(file); } }

function detectDelimiter(text){
    const delims=[',',';','\t','|'];
    const lines=text.split('\n').slice(0,5).filter(l=>l.trim());
    let max=0, best=',';
    delims.forEach(d=>{
        const count=lines.map(l=>(l.match(new RegExp('\\'+d,'g'))||[]).length).reduce((a,b)=>a+b,0);
        if(count>max){ max=count; best=d; }
    });
    return best;
}

function updateTable(){
    const text = textarea.value.trim();
    if(!text) { if(table) table.clearData(); return; }
    try {
        const dOpt = document.getElementById('delimiter').value;
        const delim = dOpt==='auto' ? detectDelimiter(text) : dOpt;
        let lines = text.split('\n');
        
        if(document.getElementById('deleteEmptyLines').checked) lines = lines.filter(l=>l.trim()!=='');
        if(document.getElementById('deleteComments').checked){
            const sym = document.getElementById('commentSymbol').value || '#';
            lines = lines.filter(l=>!l.trim().startsWith(sym));
        }

        const rows = lines.map(l => l.split(delim));
        headers = rows[0];
        const dataRows = rows.slice(1).map(r => { let o={}; headers.forEach((h,i)=> o[`col${i}`]=r[i]||''); return o; });

        if(!table){
            table = new Tabulator("#outputTable", {
                data: dataRows,
                columns: headers.map((h,i)=>({title:h, field:`col${i}`, headerFilter:"input", headerSort:true})),
                layout:"fitColumns", pagination:true, paginationSize:50
            });
        } else {
            table.setColumns(headers.map((h,i)=>({title:h, field:`col${i}`, headerFilter:"input", headerSort:true})));
            table.setData(dataRows);
        }
        document.getElementById('errorMessage').classList.add('hidden');
    } catch(e) {
        document.getElementById('errorMessage').textContent = "Error: " + e.message;
        document.getElementById('errorMessage').classList.remove('hidden');
    }
}

function exportCSV(addBOM) {
    if(!table) return;
    const data = table.getData("active");
    const content = headers.join(',') + '\n' + data.map(r => Object.values(r).join(',')).join('\n');
    const blob = new Blob([(addBOM ? "\ufeff" : "") + content], {type:'text/csv;charset=utf-8;'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = addBOM ? "excel_export.csv" : "system_pure.csv";
    link.click();
}

function copyOutput() {
    if(!table) return;
    const content = headers.join(',') + '\n' + table.getData("active").map(r => Object.values(r).join(',')).join('\n');
    navigator.clipboard.writeText(content).then(() => alert("å·²è¤‡è£½çµæœï¼"));
}

function clearInput() { textarea.value=''; if(table) table.clearData(); }
function copyInput() { textarea.select(); document.execCommand('copy'); }
textarea.addEventListener('input', updateTable);
</script>
</body>
</html>