<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Countdown</title>
<style>
:root {
  --font-stack: 'Consolas','Menlo','Monaco','Lucida Console',monospace;
}

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: var(--font-stack);
  font-weight: bold;
  cursor: pointer;
  user-select: none;
  transition: background-color .2s,color .2s;
}

#container {
  text-align: center;
  width: 100%;
}

.mode-fit #time-main {
  font-size: 18vw;
  line-height: 1;
}
.mode-fit #date {
  font-size: 4vw;
  margin-top: 2vh;
  opacity: .8;
}
.mode-fit #time-full { display: none; }

.mode-fixed #time-main,
.mode-fixed #date { display: none; }
.mode-fixed #time-full {
  font-size: 16pt;
  white-space: nowrap;
}

#controls {
  position: fixed;
  top: 10px;
  left: 10px;
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  background: rgba(255,255,255,.2);
  padding: 4px;
  border-radius: 4px;
  backdrop-filter: blur(2px);
  z-index: 10;
}

#controls button,
#controls input {
  font-size: 12px;
  padding: 2px 6px;
}

body.theme-blue   { background:#000080; color:#FFFF00; }
body.theme-white  { background:#FFFFFF; color:#333333; }
body.theme-matrix { background:#000000; color:#00FF00; }
body.theme-dark   { background:#000000; color:#FFFFFF; }

@media (max-width: 600px) and (orientation: portrait) {
  #controls {
    top: auto;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 20px);
    justify-content: center;
    padding: 8px;
    gap: 8px;
  }

  #controls button,
  #controls input {
    font-size: 16px;
    padding: 8px 12px;
  }

  #controls input[type="datetime-local"] {
    flex: 1 1 100%;
  }

  #controls button {
    flex: 1 1 auto;
    min-width: 64px;
  }
}
</style>
</head>

<body class="theme-blue mode-fit">

<div id="controls">
  <input type="datetime-local" id="dt">
  <button onclick="startMinutes(5)">5m</button>
  <button onclick="startMinutes(10)">10m</button>
  <button onclick="startMinutes(15)">15m</button>
  <button onclick="startMinutes(60)">60m</button>
  <button onclick="toNextMark(15)">→15</button>
  <button onclick="toNextMark(30)">→30</button>
  <button onclick="toNextHour()">→00</button>
  <button onclick="cycleTheme(event)">換色</button>
</div>

<div id="container">
  <div id="time-main"></div>
  <div id="date"></div>
  <div id="time-full"></div>
</div>

<script>
let target = 0;
const body = document.body;
const pad = (n,l=2)=>n.toString().padStart(l,'0');

const timeMain = document.getElementById('time-main');
const timeFull = document.getElementById('time-full');
const dateEl   = document.getElementById('date');

const themes = ['theme-blue','theme-white','theme-matrix','theme-dark'];
let themeIdx = 0;
function cycleTheme(e){
  if(e) e.stopPropagation();
  body.classList.remove(themes[themeIdx]);
  themeIdx = (themeIdx + 1) % themes.length;
  body.classList.add(themes[themeIdx]);
}

function toggleSize(){
  const fit = body.classList.contains('mode-fit');
  body.classList.toggle('mode-fit', !fit);
  body.classList.toggle('mode-fixed', fit);
}

function startMinutes(m){
  target = performance.now() + m * 60000;
  requestAnimationFrame(tick);
}

function toNextMark(mark){
  const now = new Date();
  const next = new Date(now);
  next.setSeconds(0,0);
  if(now.getMinutes() >= mark) next.setHours(now.getHours()+1);
  next.setMinutes(mark);
  target = performance.now() + (next - now);
  requestAnimationFrame(tick);
}

function toNextHour(){
  const now = new Date();
  const next = new Date(now);
  next.setHours(now.getHours()+1,0,0,0);
  target = performance.now() + (next - now);
  requestAnimationFrame(tick);
}

document.getElementById('dt').addEventListener('change', e=>{
  const t = new Date(e.target.value).getTime();
  if(!isNaN(t)){
    target = performance.now() + (t - Date.now());
    requestAnimationFrame(tick);
  }
});

function tick(now){
  if(!target) return;

  const diff = target - now;
  if(diff <= 0){
    timeMain.textContent = '00:00:00';
    timeFull.textContent = '0000/00/00 00:00:00.00';
    target = 0;
    return;
  }

  const cs = Math.floor(diff / 10) % 100;
  const s  = Math.floor(diff / 1000) % 60;
  const m  = Math.floor(diff / 60000) % 60;
  const h  = Math.floor(diff / 3600000) % 24;

  const future = new Date(Date.now() + diff);
  const dateStr = `${future.getFullYear()}/${pad(future.getMonth()+1)}/${pad(future.getDate())}`;

  const timeShort = `${pad(h)}:${pad(m)}:${pad(s)}`;
  const timeFullStr = `${timeShort}.${pad(cs)}`;

  timeMain.textContent = timeShort;
  dateEl.textContent   = dateStr;
  timeFull.textContent = `${dateStr} ${timeFullStr}`;

  requestAnimationFrame(tick);
}

body.addEventListener('click', e=>{
  if(!e.target.closest('#controls')) cycleTheme();
});
body.addEventListener('dblclick', e=>{
  if(!e.target.closest('#controls')) toggleSize();
});
</script>

</body>
</html>
