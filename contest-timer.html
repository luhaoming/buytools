<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Contest Timer</title>
<style>
:root {
  --font: Consolas, Menlo, Monaco, monospace;
}

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: var(--font);
  font-weight: bold;
  user-select: none;
  cursor: pointer;
  transition: background-color .2s, color .2s;
}

#container {
  text-align: center;
  width: 100%;
}

#label {
  font-size: 6vw;
  opacity: .85;
}

#time {
  font-size: 20vw;
  line-height: 1;
  margin-top: 2vh;
}

#controls {
  position: fixed;
  top: 10px;
  left: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  background: rgba(128,128,128,.3);
  padding: 8px;
  border-radius: 8px;
  backdrop-filter: blur(4px);
  z-index: 10;
}

#controls button {
  font-family: var(--font);
  font-size: 14px;
  font-weight: bold;
  padding: 12px 14px;
  border: none;
  border-radius: 6px;
  background: rgba(255,255,255,.9);
  color: #333;
  cursor: pointer;
  touch-action: manipulation;
}

#controls button:active {
  background: rgba(200,200,200,.9);
  transform: scale(.95);
}

#controls button.action {
  background: rgba(100,200,100,.95);
  color: #000;
}

#controls button.action:active {
  background: rgba(80,170,80,.95);
}

body.normal { background:#000; color:#fff; }
body.end    { background:#8B0000; color:#fff; }

#footer {
  position: fixed;
  bottom: 10px;
  left: 0;
  right: 0;
  text-align: center;
  font-size: 14px;
  opacity: .5;
}

/* 小手機 */
@media (max-width: 480px) {
  #controls {
    top: auto;
    bottom: 0;
    left: 0;
    right: 0;
    border-radius: 0;
    padding: 10px;
    gap: 8px;
    justify-content: center;
  }

  #controls button {
    flex: 1 1 calc(25% - 8px);
    min-width: 60px;
    padding: 14px 6px;
    font-size: 13px;
  }

  #controls button.action {
    flex: 1 1 calc(50% - 8px);
    padding: 18px 6px;
    font-size: 16px;
  }

  #label { font-size: 8vw; }
  #time { font-size: 22vw; }
  #footer { bottom: 140px; }
}

/* 更小螢幕 */
@media (max-width: 360px) {
  #controls button {
    padding: 12px 4px;
    font-size: 11px;
  }
  #controls button.action {
    padding: 16px 4px;
    font-size: 14px;
  }
}

/* 大螢幕 */
@media (min-width: 768px) {
  #controls {
    right: auto;
    max-width: 600px;
  }
}
</style>
</head>

<body class="normal">

<div id="controls">
  <button onclick="setRound(2,3)">3x2m</button>
  <button onclick="setRound(3,3)">3x3m</button>
  <button onclick="setPhase('BP',3)">BP 3m</button>
  <button onclick="setPhase('MATCH',45)">45m</button>
  <button onclick="setTotal(60)">60m</button>
  <button onclick="setTotal(90)">90m</button>
  <button onclick="setTotal(120)">120m</button>
  <button class="action" onclick="toggle()" id="toggleBtn">START</button>
  <button class="action" onclick="nextRound()">NEXT</button>
</div>

<div id="container">
  <div id="label">READY</div>
  <div id="time">00:00</div>
</div>

<div id="footer">競賽計時器</div>

<script>
let mode = '', roundTime = 0, rounds = 0, currentRound = 0;
let remain = 0, running = false, lastTick = 0;

const label = document.getElementById('label');
const timeEl = document.getElementById('time');
const toggleBtn = document.getElementById('toggleBtn');
const body = document.body;
const pad = n => n.toString().padStart(2,'0');

function beep(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const o = ctx.createOscillator();
  o.frequency.value = 1200;
  o.connect(ctx.destination);
  o.start();
  o.stop(ctx.currentTime + 0.25);
}

function setRound(min, cnt){
  mode = 'round';
  roundTime = min * 60;
  rounds = cnt;
  currentRound = 1;
  remain = roundTime;
  running = false;
  body.className = 'normal';
  update();
}

function setPhase(name, min){
  mode = 'phase';
  label.textContent = name;
  remain = min * 60;
  running = false;
  body.className = 'normal';
  update();
}

function setTotal(min){
  mode = 'total';
  label.textContent = 'TOTAL';
  remain = min * 60;
  running = false;
  body.className = 'normal';
  update();
}

function nextRound(){
  if(mode === 'round' && currentRound < rounds){
    currentRound++;
    remain = roundTime;
    running = false;
    body.className = 'normal';
    update();
  }
}

function toggle(){
  running = !running;
  lastTick = 0;
  toggleBtn.textContent = running ? 'PAUSE' : 'START';
}

function tick(ts){
  if(!running){ requestAnimationFrame(tick); return; }

  if(!lastTick) lastTick = ts;
  if(ts - lastTick >= 1000){
    remain--;
    lastTick = ts;

    if(remain <= 0){
      running = false;
      body.className = 'end';
      label.textContent = 'TIME UP';
      toggleBtn.textContent = 'START';
      beep();
    }
    update();
  }
  requestAnimationFrame(tick);
}

function update(){
  const m = Math.floor(remain / 60);
  const s = remain % 60;
  timeEl.textContent = `${pad(m)}:${pad(s)}`;
  if(mode === 'round') label.textContent = `ROUND ${currentRound}/${rounds}`;
}

document.addEventListener('keydown', e=>{
  if(e.code === 'Space') toggle();
  if(e.key === 'n' || e.key === 'N') nextRound();
});

requestAnimationFrame(tick);
</script>

</body>
</html>