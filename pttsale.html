<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>貼文產生器 ver=2025-11-25.004</title>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        textarea { width: 100%; min-height: 200px; margin: 10px 0; padding: 10px; font-size: 14px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; margin-right: 10px; }
        button:hover { background: #45a049; }
        .btn-copy { background: #2196F3; }
        .btn-copy:hover { background: #0b7dda; }
        .output { background: #f5f5f5; padding: 15px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        .btns { margin: 10px 0; }
    </style>
</head>
<body>
    <h2>貼文產生器 ver=2025-11-25.004</h2>
    
    <label>輸入：</label>
    <textarea id="input" placeholder="範例：
20 12/09_跨－原萃５８０ｍｌ系列
16 12/09_跨－光泉濃豆漿系列"></textarea>
    
    <div class="btns">
        <button onclick="generate()">產生貼文</button>
        <button class="btn-copy" onclick="copy('output')">拷貝 PTT</button>
        <button class="btn-copy" onclick="copy('outputFb')">拷貝 FB</button>
    </div>
    
    <label>PTT貼文：</label>
    <div class="output" id="output"></div>
    
    <label>FB貼文：</label>
    <div class="output" id="outputFb"></div>
    
    <hr style="margin: 30px 0; border: 1px solid #ddd;">
    
    <label>電話號碼清洗：</label>
    <input type="text" id="phoneInput" placeholder="範例：0912-123-456" style="width: 100%; padding: 10px; font-size: 14px; margin: 10px 0;">
    
    <div class="btns">
        <button onclick="cleanPhone()">清洗號碼</button>
        <button class="btn-copy" onclick="copy('phoneOutput')">拷貝</button>
    </div>
    
    <label>輸出：</label>
    <div class="output" id="phoneOutput"></div>

    <script>
        const toHalf = s => s.replace(/[Ａ-Ｚａ-ｚ０-９]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));
        
        // 計算字符串的實際顯示寬度（中文字符算2，英文字符算1）
        const getDisplayWidth = (str) => {
            let width = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str[i];
                // 判斷是否為中文字符（包括中文標點）
                if (/[\u4e00-\u9fa5\u3000-\u303f\uff00-\uffef]/.test(char)) {
                    width += 2;
                } else {
                    width += 1;
                }
            }
            return width;
        };
        
        // 填充字符串到指定顯示寬度（考慮中文字符）
        const padEndWidth = (str, targetWidth) => {
            const currentWidth = getDisplayWidth(str);
            if (currentWidth >= targetWidth) return str;
            const padding = targetWidth - currentWidth;
            return str + ' '.repeat(padding);
        };
        
        const generate = () => {
            const input = document.getElementById('input').value.trim();
            if (!input) return alert('請輸入資料');

            const lines = input.split('\n').filter(l => l.trim());
            const items = lines.map((line, i) => {
                const match = line.match(/^\s*(\d+)\s+(.+)$/);
                if (!match) return null;
                const [, qty, name] = match;
                return { letter: String.fromCharCode(65 + i), name: toHalf(name), qty };
            }).filter(Boolean);

            if (!items.length) return alert('格式錯誤');

            // 固定商品名稱欄位寬度，讓金額位置固定（考慮中文字符寬度）
            const FIXED_NAME_WIDTH = 40;
            
            // 生成 PTT 貼文格式
            const output = [
                '商品名稱：',
                '#. 兌換期限_商品名稱/售價/數量 [剩餘數量]',
                ...items.map(i => {
                    const prefix = `${i.letter}. `;
                    const prefixWidth = getDisplayWidth(prefix);
                    const nameWidth = FIXED_NAME_WIDTH - prefixWidth;
                    const paddedName = padEndWidth(i.name, nameWidth);
                    return `${prefix}${paddedName} $14 ${i.qty.padStart(2)}`;
                }),
                '',
                '交易地區：線上',
                '',
                '商品價格：參考上方商品名稱區',
                '',
                '新舊狀況：全新',
                '',
                '交易方式：街口/轉帳 後APP轉贈',
                '',
                '聯絡方式：站內信,不加賴'
            ].join('\n');

            // 生成 FB 貼文格式
            const FIXED_NAME_WIDTH_FB = 35;
            const outputFb = [
                '---',
                ...items.map(i => {
                    const prefix = `${i.letter}. `;
                    const prefixWidth = getDisplayWidth(prefix);
                    const nameWidth = FIXED_NAME_WIDTH_FB - prefixWidth;
                    const paddedName = padEndWidth(i.name, nameWidth);
                    return `${prefix}${paddedName}  $14 ${i.qty.padStart(2)}`;
                }),
                '**交易方式：街口/轉帳 後APP轉贈**'
            ].join('\n');

            document.getElementById('output').textContent = output;
            document.getElementById('outputFb').textContent = outputFb;
        };

        const copy = (outputId) => {
            const text = document.getElementById(outputId).textContent;
            if (!text) return alert('請先產生貼文');
            navigator.clipboard.writeText(text).then(() => alert('已拷貝'));
        };
        
        // 清洗電話號碼，只保留數字
        const cleanPhone = () => {
            const input = document.getElementById('phoneInput').value.trim();
            if (!input) return alert('請輸入電話號碼');
            
            // 移除所有非數字字符
            const cleaned = input.replace(/\D/g, '');
            
            document.getElementById('phoneOutput').textContent = cleaned;
        };
    </script>
</body>
</html>