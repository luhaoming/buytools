<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Talk Timer</title>
<style>
:root {
  --font-stack: 'Consolas','Menlo','Monaco','Lucida Console',monospace;
}

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: var(--font-stack);
  font-weight: bold;
  user-select: none;
  cursor: pointer;
  transition: background-color .2s,color .2s;
}

#container {
  text-align: center;
  width: 100%;
}

.mode-fit #time-main {
  font-size: 20vw;
  line-height: 1;
}
.mode-fit #status {
  font-size: 4vw;
  margin-top: 2vh;
  opacity: .85;
}
.mode-fit #info { display: none; }

.mode-fixed #time-main,
.mode-fixed #status { display: none; }
.mode-fixed #info { font-size: 16pt; }

#controls {
  position: fixed;
  top: 10px;
  left: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  background: rgba(128,128,128,.3);
  padding: 8px;
  border-radius: 8px;
  backdrop-filter: blur(4px);
  z-index: 10;
}

#controls button {
  font-family: var(--font-stack);
  font-size: 16px;
  font-weight: bold;
  padding: 12px 16px;
  border: none;
  border-radius: 6px;
  background: rgba(255,255,255,.9);
  color: #333;
  cursor: pointer;
  touch-action: manipulation;
}

#controls button:active {
  background: rgba(200,200,200,.9);
  transform: scale(.95);
}

#controls button.active {
  background: rgba(255,100,100,.9);
}

#status.start {
  cursor: pointer;
  opacity: 1;
}
#status.start:hover { text-decoration: underline; }

body.theme-blue   { background:#000080; color:#FFFF00; }
body.theme-white  { background:#FFFFFF; color:#333333; }
body.theme-matrix { background:#000000; color:#00FF00; }
body.theme-dark   { background:#000000; color:#FFFFFF; }

#footer {
  position: fixed;
  bottom: 10px;
  left: 0;
  right: 0;
  text-align: center;
  font-size: 14px;
  opacity: .5;
}

/* Â∞èÊâãÊ©ü */
@media (max-width: 480px) {
  #controls {
    top: auto;
    bottom: 0;
    left: 0;
    right: 0;
    border-radius: 0;
    padding: 12px;
    gap: 10px;
    justify-content: center;
  }

  #controls button {
    flex: 1 1 calc(25% - 10px);
    min-width: 50px;
    padding: 14px 8px;
    font-size: 15px;
  }

  .mode-fit #time-main { font-size: 24vw; }
  .mode-fit #status { font-size: 6vw; }
  #footer { bottom: 120px; }
}

/* Êõ¥Â∞èËû¢Âπï */
@media (max-width: 360px) {
  #controls button {
    flex: 1 1 calc(25% - 8px);
    padding: 12px 4px;
    font-size: 13px;
  }
}

/* Â§ßËû¢Âπï */
@media (min-width: 768px) {
  #controls {
    right: auto;
    max-width: 500px;
  }
}
</style>
</head>

<body class="theme-blue mode-fit">

<div id="controls">
  <button onclick="setMinutes(5)">5m</button>
  <button onclick="setMinutes(10)">10m</button>
  <button onclick="setMinutes(15)">15m</button>
  <button onclick="setMinutes(20)">20m</button>
  <button onclick="setMinutes(30)">30m</button>
  <button id="muteBtn" onclick="toggleMute(event)">üîä</button>
  <button onclick="cycleTheme(event)">ÊèõËâ≤</button>
</div>

<div id="container">
  <div id="time-main">00:00</div>
  <div id="status" class="start">ÈñãÂßã</div>
  <div id="info">Total: -- min | Remaining: --:--</div>
</div>

<div id="footer">ÊºîË¨õ/ËæØË´ñË®àÊôÇÂô®</div>

<script>
let totalSec = 0, remainSec = 0, running = false, muted = false, lastTick = 0;

const body = document.body;
const timeMain = document.getElementById('time-main');
const statusEl = document.getElementById('status');
const infoEl = document.getElementById('info');
const muteBtn = document.getElementById('muteBtn');

const pad = n => n.toString().padStart(2,'0');

const themes = ['theme-blue','theme-white','theme-matrix','theme-dark'];
let themeIdx = 0;
function cycleTheme(e){
  if(e) e.stopPropagation();
  body.classList.remove(themes[themeIdx]);
  themeIdx = (themeIdx + 1) % themes.length;
  body.classList.add(themes[themeIdx]);
}

function toggleSize(){
  const fit = body.classList.contains('mode-fit');
  body.classList.toggle('mode-fit', !fit);
  body.classList.toggle('mode-fixed', fit);
}

function beep(freq=800, dur=120){
  if(muted) return;
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  osc.frequency.value = freq;
  osc.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + dur/1000);
}

function setMinutes(m){
  totalSec = m * 60;
  remainSec = totalSec;
  running = false;
  updateDisplay();
  setStartState();
}

function start(){
  if(totalSec === 0) return;
  running = true;
  lastTick = 0;
  statusEl.classList.remove('start');
}

function setStartState(){
  statusEl.textContent = 'ÈñãÂßã';
  statusEl.classList.add('start');
}

function tick(ts){
  if(!running){ requestAnimationFrame(tick); return; }

  if(!lastTick) lastTick = ts;
  if(ts - lastTick >= 1000){
    remainSec--;
    lastTick = ts;

    if(remainSec === 300){ statusEl.textContent = '5 minutes left'; beep(600); }
    if(remainSec === 60){ statusEl.textContent = '1 minute left'; beep(900); beep(900); }
    if(remainSec === 0){
      statusEl.textContent = 'TIME UP';
      beep(1200,200);
      running = false;
      setStartState();
    }
    updateDisplay();
  }
  requestAnimationFrame(tick);
}

function updateDisplay(){
  const m = Math.floor(remainSec / 60);
  const s = remainSec % 60;
  timeMain.textContent = `${pad(m)}:${pad(s)}`;
  infoEl.textContent = `Total: ${Math.floor(totalSec/60)} min | Remaining: ${pad(m)}:${pad(s)}`;
}

function toggleMute(e){
  if(e) e.stopPropagation();
  muted = !muted;
  muteBtn.textContent = muted ? 'üîá' : 'üîä';
  muteBtn.classList.toggle('active', muted);
}

statusEl.addEventListener('click', e=>{
  e.stopPropagation();
  if(!running) start();
});

document.addEventListener('keydown', e=>{
  if(e.code === 'Space'){ running ? running=false : start(); lastTick = 0; }
  if(e.key === 'r' || e.key === 'R'){ remainSec = totalSec; running = false; updateDisplay(); setStartState(); }
  if(e.key === 'm' || e.key === 'M') toggleMute();
});

body.addEventListener('dblclick', e=>{ if(!e.target.closest('#controls')) toggleSize(); });
body.addEventListener('click', e=>{ if(!e.target.closest('#controls')) cycleTheme(); });

requestAnimationFrame(tick);
</script>

</body>
</html>