<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å‡½æ•¸ç‰ˆè™Ÿæ›´æ–°å™¨</title>
<style>
*{box-sizing:border-box;font-family:monospace}
body{max-width:900px;margin:20px auto;padding:0 20px}
h1{font-size:1.2em}
textarea{width:100%;height:300px;font-size:14px}
.ctrl{margin:15px 0;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input[type=number]{width:80px;padding:5px}
button{padding:8px 16px;cursor:pointer}
.detected{color:#666;font-size:12px}
</style>
</head>
<body>
<h1>ğŸ”§ å‡½æ•¸ç‰ˆè™Ÿæ›´æ–°å™¨</h1>
<p style="color:#666;margin:0">è²¼ä¸Š GAS ç¨‹å¼ç¢¼ï¼Œè‡ªå‹•å°‡æ‰€æœ‰ function åç¨±åŠ ä¸Š _vN ç‰ˆè™Ÿå¾Œç¶´ï¼ˆæˆ–æ¸…é™¤ï¼‰</p>

<div class="ctrl">
  <label><input type="radio" name="mode" value="auto" checked> è‡ªå‹• +1</label>
  <label><input type="radio" name="mode" value="add"> æŒ‡å®šç‰ˆè™Ÿ v</label>
  <input type="number" id="ver" value="1" min="1">
  <label><input type="radio" name="mode" value="clear"> æ¸…é™¤ç‰ˆè™Ÿ</label>
  <button onclick="convert()">è½‰æ›</button>
  <span class="detected" id="detected"></span>
</div>

<h3>è¼¸å…¥</h3>
<textarea id="input" placeholder="è²¼ä¸Š GAS function ç¨‹å¼ç¢¼..." oninput="detect()"></textarea>

<h3>è¼¸å‡º <button onclick="copy()">è¤‡è£½</button></h3>
<textarea id="output" readonly></textarea>

<script>
function copy() {
  navigator.clipboard.writeText(document.getElementById('output').value);
}

function detect() {
  const code = document.getElementById('input').value;
  const match = code.match(/function\s+\w+_v(\d+)\s*\(/);
  const cur = match ? parseInt(match[1]) : 0;
  document.getElementById('detected').textContent = cur ? `åµæ¸¬: v${cur} â†’ v${cur + 1}` : 'åµæ¸¬: ç„¡ç‰ˆè™Ÿ â†’ v1';
  return cur;
}

function convert() {
  const code = document.getElementById('input').value;
  const mode = document.querySelector('input[name="mode"]:checked').value;
  
  let result = code;
  
  if (mode === 'auto') {
    const cur = detect();
    const next = cur + 1;
    result = code.replace(/function\s+(\w+?)(_v\d+)?\s*\(/g, `function $1_v${next}(`);
  }
  
  if (mode === 'add') {
    const ver = document.getElementById('ver').value;
    result = code.replace(/function\s+(\w+?)(_v\d+)?\s*\(/g, `function $1_v${ver}(`);
  }
  
  if (mode === 'clear') {
    result = code.replace(/function\s+(\w+?)_v\d+\s*\(/g, 'function $1(');
  }
  
  document.getElementById('output').value = result;
}
</script>
</body>
</html>